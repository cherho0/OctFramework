<#@ template language="C#" #>
<#@ import namespace="System.Linq" #>
<#@ import namespace="System.Text" #>
<#@ import namespace="Oct.Tools.Plugin.CodeGenerator.Entity" #>
<#@ parameter type="Oct.Tools.Plugin.CodeGenerator.Entity.CodeBaseInfo" name="dt" #>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using Oct.Framework.MvcExt.Base
@using Oct.Framework.MvcExt.Extisions
@using Oct.Framework.TestWeb.Models

@model List<<#= dt.ClassName #>DTO>
<#
	var pkName1 = string.Empty;
	var pkName2 = string.Empty;
	var pkFileds = dt.FiledList.Where(d => d.IsPk);

	if (pkFileds.Count() > 0)
	{
		pkName1 = pkFileds.First().Name;	 
		pkName2 = pkName1.Substring(0, 1).ToLower() + pkName1.Substring(1, pkName1.Length - 1); 
	}
#>

<h2>Index</h2>

<div>
    @Html.AuthedLink("新增", "Create", "<#= dt.ClassName #>")
</div>

<div>
    <table>
        <tbody>
            <tr>
<#
	foreach(FiledInfo filed in dt.FiledList) 
	{		
#>
		<th><#= string.IsNullOrEmpty(filed.Description) ? filed.Name : filed.Description #></th>
<# } #>
                <th>操作</th>
            </tr>
            @foreach (var m in Model)
            {
                <tr>
<#
	foreach(FiledInfo filed in dt.FiledList) 
	{		
#>
		    <td>@m.<#= filed.Name #></td>
<# } #>
                    <td>
                        @Html.AuthedLink("查看", "Details", "<#= dt.ClassName #>", new { <#= pkName2 #> = m.<#= pkName1 #> })
                        @Html.AuthedLink("修改", "Edit", "<#= dt.ClassName #>", new { <#= pkName2 #> = m.<#= pkName1 #> })
                        @Html.AuthedLink("删除", "Delete", "<#= dt.ClassName #>", "", new { <#= pkName2 #> = m.<#= pkName1 #> }, new { onclick = "return confirm('确认删除吗？')" })
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
        </tfoot>
    </table>
</div>

<p>
    @{
        var pageModel = (PageModel)ViewBag.PM;
    }
    @Html.Pager("page", pageModel.CurrentPage, pageModel.PageSize, pageModel.Total, PageMode.Numeric)
</p>
